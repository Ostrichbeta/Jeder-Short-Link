import{a as V,b as I}from"./QScrollObserver.3c4091b3.js";import{_ as R,I as N,K as h,L as k,M as i,T as l,N as s,as as d,S as u,aK as U,aq as y,w as p,P as f,Q,V as $,at as v,au as L,av as C,aw as T,ar as q,aL as A,aM as M,U as E,R as x}from"./index.3a866874.js";import{Q as _,a as S,b as D,c as P,d as B}from"./QScrollArea.50c6f3a9.js";import{Q as F}from"./QResizeObserver.33862b8f.js";import{Q as K,a as O}from"./QDate.bf8c05c5.js";import{Q as z}from"./QPage.f9ba1667.js";import{C as g}from"./ClosePopup.6696a859.js";import{a as m}from"./axios.bf56c3c5.js";import{u as Y}from"./userinfo.36092a26.js";import{s as H}from"./sha256.6c01c987.js";const c=Y(),j="production",o=j.toLowerCase()=="development"?"http://localhost:3000":"",G=N({name:"ManageLink",data(){return{newURL:"",parallaxHeight:0,foregroundSize:{},newSelTime:0,dateTimePickerOpen:!1,showAdvancedSettings:!1,selectedLinks:[],removeLinkDlgShow:!1,editLinkDlgShow:!1,newTargetLink:"",newExpireTime:0,newName:"",newLinkNeverExpire:!0,editingID:"",searchText:"",dropdownLabel:"ID",currentLinkLists:[],shortLinkColumns:[{name:"id",label:"ID",field:"id",align:"left"},{name:"name",label:"Name",field:"name",align:"left"},{name:"source",label:"Source Link",field:"SOURCE_LINK",format:e=>`/${e}`,align:"left"},{name:"target",label:"Target Link",field:"TARGET_LINK",format:e=>`${e.length>=40?e.substring(0,40)+"...":e}`,align:"left"},{name:"createat",label:"Created At",field:"CREATED_AT",format:e=>`${this.formatTime(e)}`,align:"left"},{name:"expireat",label:"Expire At",field:"EXPIRE_AT",format:e=>`${e==-1?"Never":this.formatTime(e)}`,align:"left"},{name:"clickcount",label:"Clicks",field:"CLICKCOUNT"}],canModifyDomain:!1,shortLinkColumnsAdmin:[{name:"id",label:"ID",field:"id",align:"left"},{name:"name",label:"Name",field:"name",align:"left"},{name:"source",label:"Source Link",field:"SOURCE_LINK",format:e=>`/${e}`,align:"left"},{name:"target",label:"Target Link",field:"TARGET_LINK",format:e=>`${e.length>=40?e.substring(0,40)+"...":e}`,align:"left"},{name:"createdby",label:"Created By",field:"CREATED_BY",align:"left"},{name:"createat",label:"Created At",field:"CREATED_AT",format:e=>`${this.formatTime(e)}`,align:"left"},{name:"expireat",label:"Expire At",field:"EXPIRE_AT",format:e=>`${e==-1?"Never":this.formatTime(e)}`,align:"left"},{name:"clickcount",label:"Clicks",field:"CLICKCOUNT"}]}},computed:{newLinkExpireTime(){return this.newLinkNeverExpire?-1:this.newExpireTime},currentUserRole(){return c.role}},async mounted(){try{let e=await m.get(o+"/acheck/profile",{withCredentials:!0});e.status==200&&e.data.status=="success"&&(c.isLoggedIn=!0,c.name=e.data.profile.name?e.data.profile.name:"",c.username=e.data.profile.username?e.data.profile.username:"");let t=await m.get(o+"/acheck/checkuser",{withCredentials:!0});if(t.status==200&&t.data.status=="success"){c.role=t.data.results[0].ROLE;let n=H.exports.sha256(c.username);c.avatarImgSource=`https://gravatar.com/avatar/${n}?s=256&d=retro`}try{let n=await m.get(o+"/api/usergetlinklist",{withCredentials:!0});n.status==200&&n.data.status=="success"&&(this.currentLinkLists=n.data.results)}catch(n){n.response&&this.$q.notify({message:`${n.response.data.reason}`,color:"negative"}),console.error(n)}}catch(e){e.response&&(e.response.status==404?(c.role=-1,this.$router.push("/nopermission")):(this.$q.notify({message:`${e.response.data.reason}`,color:"negative"}),c.isLoggedIn=!1,this.$router.push("/login")))}},methods:{foregroundDivChanged(e){this.foregroundSize=e,this.parallaxHeight=(this.foregroundSize.height?this.foregroundSize.height:0)+96},onExpireFocus(e){e&&(e.target.blur(),this.newSelTime=(Math.ceil(Date.now()/1e3)*1e3).toString(),this.dateTimePickerOpen=!0)},onExpireTimeSet(e){this.newExpireTime=parseInt(this.newSelTime)!=NaN?parseInt(this.newSelTime):0,this.newSelTime=0},formatTime(e){const t=(r,b=2)=>`${new Array(b).fill(0)}${r}`.slice(-b),n=new Date(e);return`${t(n.getFullYear(),4)}-${t(n.getMonth()+1)}-${t(n.getDate())} ${t(n.getHours())}:${t(n.getMinutes())}:${t(n.getSeconds())}`},async lineEditBtnClick(e){if(e)try{this.canModifyDomain=!1,this.editingID=e;let t=await m.get(o+"/api/usergetdetail",{withCredentials:!0,params:{id:this.editingID}});if(t.status==200&&t.data.status=="success"){let n=t.data.results[0];this.newName=n.name,this.newTargetLink=n.TARGET_LINK,this.newExpireTime=n.EXPIRE_AT,await this.modifyPermissionCheck(e)&&(this.canModifyDomain=!0),this.editLinkDlgShow=!0}}catch(t){t.response&&this.$q.notify({message:`${t.response.data.reason}`,color:"negative"}),console.error(t)}},async modifyPermissionCheck(e){try{let t=await m.get(o+"/api/usercheckpermission",{withCredentials:!0,params:{id:e}});if(t.status==200&&t.data.status=="success")return!0}catch(t){return t.response&&t.response.status!=403&&(this.$q.notify({message:`${t.response.data.reason}`,color:"negative"}),console.error(t)),!1}},dropdownFilterClicked(e){switch(e){case"ID":this.dropdownLabel="ID";break;case"SL":this.dropdownLabel="Source Link";break;case"TL":this.dropdownLabel="Target Link";break;default:console.error("Damn");break}},async onSearchBtnClick(e){if(this.currentLinkLists=[],this.searchText=="")try{let t=await m.get(o+"/api/usergetlinklist",{withCredentials:!0});t.status==200&&t.data.status=="success"&&(this.currentLinkLists=t.data.results)}catch(t){t.response&&this.$q.notify({message:`${t.response.data.reason}`,color:"negative"}),console.error(t)}else{let t=o+"/api/usergetlinklist",n={};switch(this.dropdownLabel){case"ID":t=o+"/api/usergetdetail",n={params:{id:this.searchText},withCredentials:!0};break;case"Source Link":t=o+"/api/usergetdetail",n={params:{source:this.searchText},withCredentials:!0};break;case"Target Link":t=o+"/api/usergetdetail",n={params:{target:this.searchText},withCredentials:!0};break}try{let r=await m.get(t,n);console.log(r),r.status==200&&r.data.status=="success"&&(this.currentLinkLists=r.data.results)}catch(r){r.response&&r.response.status!=403&&this.$q.notify({message:`${r.response.data.reason}`,color:"negative"}),console.error(r)}}},async submitSearchDialog(e){if(e)try{if((await m.get(o+"/api/userlinkmodify",{withCredentials:!0,params:{id:this.editingID,name:this.newName,expireat:this.newLinkExpireTime}})).status==200){this.onSearchBtnClick(),this.editLinkDlgShow=!1,this.$q.notify({message:"Done",color:"positive"});return}}catch(t){t.response&&this.$q.notify({message:`${t.response.data.reason}`,color:"negative"}),console.error(t)}},async batchRemove(e){if(e)try{let t=[];for(const r of this.selectedLinks)t.push(r.id);this.selectedLinks=[];let n=await m.post(o+"/api/userlinkbatchremove",{ids:t},{withCredentials:!0});n.status==200&&n.data.status=="success"&&(this.$q.notify({message:"Done",color:"positive"}),this.onSearchBtnClick(),this.removeLinkDlgShow=!1)}catch(t){t.response&&t.response.status!=403?this.$q.notify({message:`${t.response.data.reason}`,color:"negative"}):t.response&&t.response.status==403&&(this.$q.notify({message:"Permission Denied",color:"negative"}),this.removeLinkDlgShow=!1),console.error(t)}}}}),X={class:"column q-py-lg q-mt-none q-gutter-y-md flex items-center full-width content-center"},W={class:"full-width",ref:"foregrounddiv"},J=l("div",{class:"full-width"},[l("p",{style:{"text-shadow":"2px 2px #4c3d30"},class:"gt-xs text-center text-h3 text-white"},"Manage Links ")],-1),Z=l("div",{class:"full-width"},[l("p",{style:{"text-shadow":"2px 2px #4c3d30"},class:"gt-xs text-center text-h6 text-white"},"Manage the links you've created")],-1),ee=l("div",{class:"full-width"},[l("p",{style:{"text-shadow":"2px 2px #4c3d30"},class:"xs text-center text-h5 text-white"},"Manage Links")],-1),te=l("div",{class:"full-width"},[l("p",{style:{"text-shadow":"2px 2px #4c3d30"},class:"xs text-center text-body2 text-white"},"Manage the links you've created")],-1),se=l("div",{class:"full-width row justify-center q-pt-md"},[l("div",{class:"col-10 gt-xs"})],-1),ae={class:"row full-width justify-center"},ie={class:"col-11 col-md-8"},le={class:"flex no-wrap"},ne=l("div",{class:"text-h6"},"Links list",-1),re={class:"content-start flex full-width"},oe={class:"content-start flex no-wrap"},de=l("div",{class:"q-pt-none q-pb-xl"},null,-1),ue=l("div",{class:"text-h6"},"Select expire time",-1),me=l("div",{class:"text-h6"},"Warning",-1),ce={class:"q-my-none"},fe={class:"text-h6 ellipsis"},he=l("div",{class:"text-body2 text-negative"},"This link was created by users with higher permission. You can only read the settings only.",-1),pe={class:"q-py-sm q-px-sm"},ge=l("div",{class:"fixed-bottom-right text-white q-pb-sm q-pr-md"},[l("p",{class:"attribution q-ma-none"},[f('"'),l("a",{rel:"noopener noreferrer",class:"text-white",href:"https://www.flickr.com/photos/69806124@N04/6775983965"},"Keyboard"),f('" by '),l("a",{rel:"noopener noreferrer",class:"text-white",href:"https://www.flickr.com/photos/69806124@N04"},"LawlessTech"),f(" is licensed under "),l("a",{rel:"noopener noreferrer",class:"text-white",href:"https://creativecommons.org/licenses/by/2.0/?ref=openverse"},[f("CC BY 2.0 "),l("img",{src:"https://mirrors.creativecommons.org/presskit/icons/cc.svg",style:{height:"1em","margin-right":"0.125em",display:"inline"}}),l("img",{src:"https://mirrors.creativecommons.org/presskit/icons/by.svg",style:{height:"1em","margin-right":"0.125em",display:"inline"}})]),f(".")])],-1);function ke(e,t,n,r,b,we){return h(),k(z,{class:"flex column flex-center q-px-none q-px-md-none bg-image"},{default:i(()=>[l("div",X,[l("div",W,[J,Z,ee,te,se,l("div",ae,[l("div",ie,[s(L,{class:"my-card",style:{"background-color":"rgba(250,250,250,.8)"}},{default:i(()=>[s(d,{class:"q-pb-none"},{default:i(()=>[l("div",le,[ne,s(V),s(u,{flat:"",rounded:"",color:"primary",icon:"mdi-delete",label:"Delete selected",class:U({invisible:e.selectedLinks.length==0}),disable:e.selectedLinks.length==0,onClick:t[0]||(t[0]=a=>e.removeLinkDlgShow=!0)},null,8,["class","disable"])])]),_:1}),s(d,{class:"q-py-none q-my-sm"},{default:i(()=>[s(y,{outlined:"",dense:"",modelValue:e.searchText,"onUpdate:modelValue":t[5]||(t[5]=a=>e.searchText=a),label:e.dropdownLabel},{before:i(()=>[s(u,{round:"",dense:"",flat:"",icon:"mdi-filter"},{default:i(()=>[s(I,null,{default:i(()=>[s(_,{bordered:""},{default:i(()=>[p((h(),k(S,{clickable:"",onClick:t[1]||(t[1]=a=>e.dropdownFilterClicked("ID"))},{default:i(()=>[s(D,null,{default:i(()=>[f("ID")]),_:1})]),_:1})),[[x],[g]]),p((h(),k(S,{clickable:"",onClick:t[2]||(t[2]=a=>e.dropdownFilterClicked("SL"))},{default:i(()=>[s(D,null,{default:i(()=>[f("Source Link")]),_:1})]),_:1})),[[x],[g]]),p((h(),k(S,{clickable:"",onClick:t[3]||(t[3]=a=>e.dropdownFilterClicked("TL"))},{default:i(()=>[s(D,null,{default:i(()=>[f("Target Link")]),_:1})]),_:1})),[[x],[g]])]),_:1})]),_:1})]),_:1})]),append:i(()=>[e.searchText!==""?(h(),k(Q,{key:0,name:"close",onClick:t[4]||(t[4]=a=>e.searchText=""),class:"cursor-pointer"})):$("",!0)]),after:i(()=>[s(u,{round:"",dense:"",flat:"",icon:"mdi-magnify",onClick:e.onSearchBtnClick},null,8,["onClick"])]),_:1},8,["modelValue","label"])]),_:1}),s(d,{class:"q-pt-none"},{default:i(()=>[s(P,{flat:"",class:"transparent",rows:e.currentLinkLists,columns:e.currentUserRole<=1?e.shortLinkColumnsAdmin:e.shortLinkColumns,"row-key":"id",selection:"multiple",selected:e.selectedLinks,"onUpdate:selected":t[6]||(t[6]=a=>e.selectedLinks=a),"no-data-label":"No link created by you"},{"header-selection":i(a=>[l("div",re,[s(v,{modelValue:a.selected,"onUpdate:modelValue":w=>a.selected=w},null,8,["modelValue","onUpdate:modelValue"])])]),"body-selection":i(a=>[l("div",oe,[s(v,{modelValue:a.selected,"onUpdate:modelValue":w=>a.selected=w},null,8,["modelValue","onUpdate:modelValue"]),s(u,{flat:"",round:"",color:"primary",icon:"mdi-pencil",class:"q-ml-xs",onClick:w=>e.lineEditBtnClick(a.key)},null,8,["onClick"])])]),_:1},8,["rows","columns","selected"])]),_:1})]),_:1})])]),de,s(F,{onResize:e.foregroundDivChanged},null,8,["onResize"])],512)]),s(T,{modelValue:e.dateTimePickerOpen,"onUpdate:modelValue":t[9]||(t[9]=a=>e.dateTimePickerOpen=a),persistent:""},{default:i(()=>[s(L,{style:{"min-width":"350px","max-width":"70vw"}},{default:i(()=>[s(d,null,{default:i(()=>[ue]),_:1}),s(d,{class:"q-pt-none q-gutter-md row justify-center"},{default:i(()=>[s(K,{modelValue:e.newSelTime,"onUpdate:modelValue":t[7]||(t[7]=a=>e.newSelTime=a),mask:"x","with-seconds":""},null,8,["modelValue"]),s(O,{modelValue:e.newSelTime,"onUpdate:modelValue":t[8]||(t[8]=a=>e.newSelTime=a),mask:"x"},null,8,["modelValue"])]),_:1}),s(C,{align:"right",class:"q-pt-none text-primary"},{default:i(()=>[p(s(u,{flat:"",label:"Cancel"},null,512),[[g]]),p(s(u,{flat:"",label:"OK",onClick:e.onExpireTimeSet},null,8,["onClick"]),[[g]])]),_:1})]),_:1})]),_:1},8,["modelValue"]),s(T,{modelValue:e.removeLinkDlgShow,"onUpdate:modelValue":t[10]||(t[10]=a=>e.removeLinkDlgShow=a),persistent:""},{default:i(()=>[s(L,{style:{"min-width":"350px","max-width":"450px"}},{default:i(()=>[s(d,null,{default:i(()=>[me]),_:1}),s(d,{class:"q-pt-none"},{default:i(()=>[f(" Are you sure to remove the links below? There will be no way to restore! ")]),_:1}),s(d,{class:"q-pt-none"},{default:i(()=>[s(B,{"thumb-style":e.thumbStyle,"bar-style":e.barStyle,style:{height:"100px"}},{default:i(()=>[l("ul",ce,[(h(!0),q(M,null,A(e.selectedLinks,a=>(h(),q("li",{key:a},E(a.id),1))),128))])]),_:1},8,["thumb-style","bar-style"])]),_:1}),s(C,{align:"right",class:"text-primary"},{default:i(()=>[p(s(u,{flat:"",label:"No"},null,512),[[g]]),p(s(u,{flat:"",label:"Yes",onClick:e.batchRemove},null,8,["onClick"]),[[g]])]),_:1})]),_:1})]),_:1},8,["modelValue"]),s(T,{modelValue:e.editLinkDlgShow,"onUpdate:modelValue":t[15]||(t[15]=a=>e.editLinkDlgShow=a),persistent:""},{default:i(()=>[s(L,{style:{"min-width":"350px","max-width":"350px"}},{default:i(()=>[s(d,null,{default:i(()=>[l("div",fe,"Edit Link: "+E(e.editingID),1)]),_:1}),e.canModifyDomain?$("",!0):(h(),k(d,{key:0,class:"q-pt-none q-px-lg"},{default:i(()=>[he]),_:1})),s(d,{class:"q-pt-none"},{default:i(()=>[s(y,{class:"q-mb-sm",filled:"",modelValue:e.newName,"onUpdate:modelValue":t[11]||(t[11]=a=>e.newName=a),label:"Name",rules:[a=>!!a||"Field Required"],readonly:!e.canModifyDomain},null,8,["modelValue","rules","readonly"]),s(y,{class:"q-mb-sm",filled:"",readonly:"",modelValue:e.newTargetLink,"onUpdate:modelValue":t[12]||(t[12]=a=>e.newTargetLink=a),label:"Target Link",rules:[a=>!!a||"Field Required"]},null,8,["modelValue","rules"]),s(y,{class:"q-mb-sm",filled:"",modelValue:e.newLinkExpireTime,"onUpdate:modelValue":t[13]||(t[13]=a=>e.newLinkExpireTime=a),label:"Expire Time",onFocus:e.onExpireFocus,readonly:!e.canModifyDomain,disable:e.newLinkNeverExpire},null,8,["modelValue","onFocus","readonly","disable"]),l("div",pe,[s(v,{modelValue:e.newLinkNeverExpire,"onUpdate:modelValue":t[14]||(t[14]=a=>e.newLinkNeverExpire=a),label:"Link never expires",disable:!e.canModifyDomain},null,8,["modelValue","disable"])])]),_:1}),s(C,{align:"right",class:"text-primary"},{default:i(()=>[p(s(u,{flat:"",label:"Cancel"},null,512),[[g]]),s(u,{flat:"",label:"Save",onClick:e.submitSearchDialog,disable:!e.canModifyDomain},null,8,["onClick","disable"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),ge]),_:1})}var qe=R(G,[["render",ke]]);export{qe as default};
