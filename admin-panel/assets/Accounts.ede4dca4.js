import{Q as y,a as o,b as C,c as u,d as f}from"./QPage.5243932f.js";import{Q as v,a as L,b as R,c as p,d as w,e as k,C as U}from"./ClosePopup.79635d45.js";import{_ as S,E as D,G as m,H as V,I as l,J as s,L as h,M as r,w as g,X as i,Y as b,Z as q,$ as A,a0 as $}from"./index.6dff6d9f.js";import{a as n}from"./axios.bf56c3c5.js";import{a as M}from"./login-state.316deaee.js";import"./QScrollObserver.31fd6b98.js";const Q="production",d=Q.toLowerCase()=="development"?"http://localhost:3000":"",E=D({name:"AccountsPage",data(){return{userColumns:[{name:"email",label:"Email",required:!0,field:"EMAIL",align:"left",sortable:!0},{name:"comment",label:"Comments",field:"COMMENT",align:"left",sortable:!1},{name:"role",label:"Role",field:"ROLE",sortable:!0}],usersList:[],emptyUserList:[],selectedUsers:[],adduserDlgShow:!1,deluserDlgShow:!1,newUserMail:"",newUserComment:"",newUserRole:{},newUserRoles:[{label:"Ultimate Administrator (0)",value:0,description:"This account has the all the permissions that a token can do."},{label:"Administrator (1)",value:1,description:"This account can modify all links created by administrators and normal users."},{label:"Normal User (99)",value:99,description:"This account can create links, and remove the links create by himself or herself."}]}},methods:{addUserBtnClick(){this.adduserDlgShow=!0,this.newUserMail="",this.newUserComment="",this.newUserRole=this.newUserRoles[this.newUserRoles.length-1]},async submitAddUserDlg(){if(await this.$refs.userMailTextField.validate())try{let e=await n.get(d+"/api/adduser",{withCredentials:!0,params:{email:this.newUserMail,comment:this.newUserComment,role:this.newUserRole.value}});e.status==200&&e.data.status=="success"&&this.$q.notify({message:"Done",color:"positive"}),await this.refreshUserLists(),this.adduserDlgShow=!1}catch(e){e.response&&this.$q.notify({message:`${e.response.data.reason}`,color:"negative"}),console.error(e)}},async submitRemoveUserDlg(){try{let e=[];for(const c of this.selectedUsers)e.push(c.EMAIL);this.selectedUsers=[];let t=await n.post(d+"/api/batchremoveuser",{users:e},{withCredentials:!0});t.status==200&&t.data.status=="success"&&(this.$q.notify({message:"Done",color:"positive"}),this.deluserDlgShow=!1)}catch(e){e.response&&this.$q.notify({message:`${e.response.data.reason}`,color:"negative"}),console.error(e)}await this.refreshUserLists()},async refreshUserLists(){try{this.usersList=[];let e=await n.get(d+"/api/getuserlist",{withCredentials:!0});e.status==200&&e.data.status=="success"&&(this.usersList=e.data.results)}catch(e){e.response&&this.$q.notify({message:`${e.response.data.reason}`,color:"negative"}),console.error(e)}}},async mounted(){const e=M();try{let t=await n.get(d+"/api/getme",{withCredentials:!0});t.status!=200||t.data.user!="root"?e.isLogin=!1:e.isLogin=!0}catch{e.isLogin=!1}e.isLogin?await this.refreshUserLists():this.$router.push("/")}}),T=i("div",{class:"text-h6"},"Approved accounts",-1),B=i("br",null,null,-1),I=i("div",{class:"text-h6"},"Add a user",-1),N=i("div",{class:"text-h6"},"Warning",-1),F={class:"q-my-none"};function P(e,t,c,G,O,Y){return m(),V(y,{class:"flex column items-start content-center q-gutter-y-md q-pt-md q-px-lg q-px-md-none"},{default:l(()=>[s(u,{bordered:"",class:"my-card full-width",style:{"max-width":"800px"}},{default:l(()=>[s(o,null,{default:l(()=>[T]),_:1}),s(o,{class:"q-pt-none"},{default:l(()=>[h(" Microsoft accounts that have permissions to create, modify or delete short links. "),B,h(" If no account listed, only the super token has the permissions to operate the links. ")]),_:1}),s(v,{inset:""}),s(o,{class:"q-mx-sm"},{default:l(()=>[s(L,{flat:"",bordered:"",rows:e.usersList,columns:e.userColumns,"row-key":"EMAIL","no-data-label":"No user",selection:"multiple",selected:e.selectedUsers,"onUpdate:selected":t[0]||(t[0]=a=>e.selectedUsers=a)},null,8,["rows","columns","selected"])]),_:1}),s(o,{class:"flex row justify-end items-center"},{default:l(()=>[s(C,{push:"",flat:""},{default:l(()=>[s(r,{label:"Add",icon:"mdi-account-plus",onClick:e.addUserBtnClick},null,8,["onClick"]),s(r,{label:"Remove",icon:"mdi-account-minus",disable:e.selectedUsers.length==0,onClick:t[1]||(t[1]=a=>e.deluserDlgShow=!0)},null,8,["disable"])]),_:1})]),_:1})]),_:1}),s(w,{modelValue:e.adduserDlgShow,"onUpdate:modelValue":t[5]||(t[5]=a=>e.adduserDlgShow=a),persistent:""},{default:l(()=>[s(u,{style:{width:"450px"}},{default:l(()=>[s(o,null,{default:l(()=>[I]),_:1}),s(o,{class:"q-pt-none"},{default:l(()=>[s(f,{modelValue:e.newUserMail,"onUpdate:modelValue":t[2]||(t[2]=a=>e.newUserMail=a),label:"Email",rules:[a=>!!a||"Field Required"],ref:"userMailTextField"},null,8,["modelValue","rules"]),s(f,{modelValue:e.newUserComment,"onUpdate:modelValue":t[3]||(t[3]=a=>e.newUserComment=a),label:"Comment",hint:" "},null,8,["modelValue"]),s(R,{modelValue:e.newUserRole,"onUpdate:modelValue":t[4]||(t[4]=a=>e.newUserRole=a),label:"Role",options:e.newUserRoles,hint:e.newUserRole?e.newUserRole.description:""},null,8,["modelValue","options","hint"])]),_:1}),s(p,{align:"right",class:"text-primary"},{default:l(()=>[g(s(r,{flat:"",label:"Cancel"},null,512),[[U]]),s(r,{flat:"",label:"Add User",onClick:e.submitAddUserDlg},null,8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),s(w,{modelValue:e.deluserDlgShow,"onUpdate:modelValue":t[6]||(t[6]=a=>e.deluserDlgShow=a),persistent:""},{default:l(()=>[s(u,{style:{"min-width":"350px","max-width":"450px"}},{default:l(()=>[s(o,null,{default:l(()=>[N]),_:1}),s(o,{class:"q-pt-none"},{default:l(()=>[h(" Are you sure to remove the users below? There will be no way to restore! ")]),_:1}),s(o,{class:"q-pt-none"},{default:l(()=>[s(k,{"thumb-style":e.thumbStyle,"bar-style":e.barStyle,style:{height:"100px"}},{default:l(()=>[i("ul",F,[(m(!0),b(A,null,q(e.selectedUsers,a=>(m(),b("li",{key:a},$(a.EMAIL),1))),128))])]),_:1},8,["thumb-style","bar-style"])]),_:1}),s(p,{align:"right",class:"text-primary"},{default:l(()=>[g(s(r,{flat:"",label:"No"},null,512),[[U]]),s(r,{flat:"",label:"Yes",onClick:e.submitRemoveUserDlg},null,8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}var _=S(E,[["render",P]]);export{_ as default};
